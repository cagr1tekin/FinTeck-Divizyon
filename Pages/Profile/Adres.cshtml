@page
@model InteraktifKredi.Pages.Profile.AdresModel
@{
    ViewData["Title"] = "Profil Bilgilerim";
    var customerIdStr = HttpContext.Session.GetString("CustomerId");
    var customerId = !string.IsNullOrEmpty(customerIdStr) && long.TryParse(customerIdStr, out var id) ? id : 0;
    var initials = string.Empty;
    if (!string.IsNullOrEmpty(Model.FirstName) && !string.IsNullOrEmpty(Model.LastName))
    {
        initials = Model.FirstName.Substring(0, 1).ToUpper() + Model.LastName.Substring(0, 1).ToUpper();
    }
    else if (!string.IsNullOrEmpty(Model.CustomerName))
    {
        var parts = Model.CustomerName.Split(' ');
        initials = parts.Length > 0 ? parts[0].Substring(0, 1).ToUpper() : "M";
        if (parts.Length > 1)
        {
            initials += parts[1].Substring(0, 1).ToUpper();
        }
    }
    else
    {
        initials = "MU";
    }
}

<div class="profile_page_container">
    <!-- Success/Error Messages -->
    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="form_success_message">
            <span class="form_success_message__icon">✓</span>
            <span class="form_success_message__text">@Model.SuccessMessage</span>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="form_error_message">
            <span class="form_error_message__icon">⚠</span>
            <span class="form_error_message__text">@Model.ErrorMessage</span>
        </div>
    }

    <div class="profile_layout">
        <!-- Left Sidebar -->
        <aside class="profile_sidebar">
            <!-- User Info Card -->
            <div class="profile_user_card">
                <div class="profile_user_card__body">
                    <div class="profile_user_card__avatar">
                        <div class="profile_avatar">
                            <span class="profile_avatar__text">@initials</span>
                        </div>
                    </div>
                    
                    <div class="profile_user_card__phone">
                        <strong>@(Model.Phone ?? "")</strong>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.TCKN))
                    {
                        <div class="profile_user_card__tckn">
                            <span class="profile_user_card__label">TCKN:</span>
                            <span class="profile_user_card__value">@Model.TCKN</span>
                        </div>
                    }
                    
                    <div class="profile_user_card__last_signin">
                        Son giriş: Az önce
                    </div>
                </div>
            </div>

            <!-- User ID Card -->
            <div class="profile_user_id_card">
                <div class="profile_user_id_card__header">
                    <h3 class="profile_user_id_card__title">User ID</h3>
                </div>
                <div class="profile_user_id_card__body">
                    <div class="profile_user_id_card__wrapper">
                        <input type="text" class="profile_user_id_card__input" value="user_@(customerId.ToString().PadLeft(10, '0'))..." readonly />
                        <button type="button" class="profile_user_id_card__copy" onclick="copyUserId()">Copy</button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Right Main Content -->
        <main class="profile_main_content">
            <!-- Adres Bilgileri Card -->
            <div class="info_card" data-card="address">
                <div class="info_card__header">
                    <h2 class="info_card__title">Adres Bilgileri</h2>
                    <button type="button" class="info_card__edit_btn" data-action="edit" aria-label="Düzenle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </button>
                    <button type="button" class="info_card__save_btn" data-action="save" style="display: none;" aria-label="Kaydet">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </button>
                </div>
                <div class="info_card__body">
                    <div class="form_row">
                        <div class="form_group">
                            <label class="form_label">İl</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.AddressData?.CityId.HasValue == true ? Model.Cities.FirstOrDefault(c => c.Value == Model.AddressData.CityId.Value.ToString())?.Text ?? "" : "")" readonly />
                        </div>
                        <div class="form_group">
                            <label class="form_label">İlçe</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.AddressData?.TownId.HasValue == true ? Model.Districts.FirstOrDefault(d => d.Value == Model.AddressData.TownId.Value.ToString())?.Text ?? "" : "")" readonly />
                        </div>
                    </div>
                    <div class="form_row">
                        <div class="form_group form_group--full">
                            <label class="form_label">Adres</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.AddressData?.Address ?? "")" readonly />
                        </div>
                    </div>
                </div>
            </div>

            <!-- İş Bilgileri Card -->
            <div class="info_card" data-card="job">
                <div class="info_card__header">
                    <h2 class="info_card__title">İş Bilgileri</h2>
                    <button type="button" class="info_card__edit_btn" data-action="edit" aria-label="Düzenle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </button>
                    <button type="button" class="info_card__save_btn" data-action="save" style="display: none;" aria-label="Kaydet">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </button>
                </div>
                <div class="info_card__body">
                    <div class="form_row">
                        <div class="form_group">
                            <label class="form_label">Meslek Grubu</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.JobData?.JobGroupName ?? "")" readonly />
                        </div>
                        <div class="form_group">
                            <label class="form_label">Meslek</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.JobData?.OccupationName ?? "")" readonly />
                        </div>
                    </div>
                    <div class="form_row">
                        <div class="form_group">
                            <label class="form_label">Şirket Adı</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.JobData?.TitleCompany ?? "")" readonly />
                        </div>
                        <div class="form_group">
                            <label class="form_label">Pozisyon</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.JobData?.CompanyPosition ?? "")" readonly />
                        </div>
                    </div>
                    <div class="form_row">
                        <div class="form_group">
                            <label class="form_label">Çalışma Süresi</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.JobData?.WorkingYears.HasValue == true || Model.JobData?.WorkingMonth.HasValue == true ? $"{Model.JobData.WorkingYears ?? 0} yıl {Model.JobData.WorkingMonth ?? 0} ay" : "")" readonly />
                        </div>
                        <div class="form_group">
                            <label class="form_label">Aylık Gelir</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.FinanceData?.SalaryAmount.HasValue == true && Model.FinanceData.SalaryAmount.Value > 0 ? $"{Model.FinanceData.SalaryAmount.Value:N0} ₺" : "")" readonly />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Eş Bilgileri Card -->
            <div class="info_card" data-card="wife">
                <div class="info_card__header">
                    <h2 class="info_card__title">Eş Bilgileri</h2>
                    <button type="button" class="info_card__edit_btn" data-action="edit" aria-label="Düzenle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </button>
                    <button type="button" class="info_card__save_btn" data-action="save" style="display: none;" aria-label="Kaydet">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </button>
                </div>
                <div class="info_card__body">
                    <div class="form_row">
                        <div class="form_group">
                            <label class="form_label">Medeni Durum</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.WifeData?.MaritalStatus == true ? "Evli" : Model.WifeData?.MaritalStatus == false ? "Bekar" : "")" readonly />
                        </div>
                        <div class="form_group">
                            <label class="form_label">Eş Çalışıyor mu?</label>
                            <input type="text" class="form_input form_input--readonly" value="@(Model.WifeData?.WorkWife == true ? "Evet" : Model.WifeData?.WorkWife == false ? "Hayır" : "")" readonly />
                        </div>
                    </div>
                    @if (Model.WifeData?.WorkWife == true && Model.WifeData?.WifeSalaryAmount.HasValue == true)
                    {
                        <div class="form_row">
                            <div class="form_group">
                                <label class="form_label">Eş Maaşı</label>
                                <input type="text" class="form_input form_input--readonly" value="@($"{Model.WifeData.WifeSalaryAmount.Value:N0} ₺")" readonly />
                            </div>
                        </div>
                    }
                </div>
            </div>
        </main>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Copy User ID
            function copyUserId() {
                var $input = $('.profile_user_id_card__input');
                $input.select();
                document.execCommand('copy');
                
                var $btn = $('.profile_user_id_card__copy');
                var originalText = $btn.text();
                $btn.text('Kopyalandı!');
                setTimeout(function() {
                    $btn.text(originalText);
                }, 2000);
            }
            
            window.copyUserId = copyUserId;

            // Edit/Save functionality
            $('.info_card__edit_btn').on('click', function() {
                var $card = $(this).closest('.info_card');
                var $editBtn = $card.find('.info_card__edit_btn');
                var $saveBtn = $card.find('.info_card__save_btn');
                var $inputs = $card.find('.form_input--readonly');
                
                // Make inputs editable
                $inputs.prop('readonly', false).removeClass('form_input--readonly');
                
                // Toggle buttons
                $editBtn.hide();
                $saveBtn.show();
            });

            $('.info_card__save_btn').on('click', function() {
                var $card = $(this).closest('.info_card');
                var $editBtn = $card.find('.info_card__edit_btn');
                var $saveBtn = $card.find('.info_card__save_btn');
                var $inputs = $card.find('.form_input');
                
                // Make inputs readonly again
                $inputs.prop('readonly', true).addClass('form_input--readonly');
                
                // Toggle buttons
                $editBtn.show();
                $saveBtn.hide();
                
                // TODO: API call to save data
                var cardType = $card.data('card');
                console.log('Saving data for:', cardType);
            });
        });
    </script>
}
