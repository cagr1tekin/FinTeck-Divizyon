<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="@(ViewData["Description"] ?? "İnteraktif Kredi - Web Şube 2.0. Dijital kredi başvurusu yapın, hızlı ve güvenli şekilde kredi başvurunuzu tamamlayın.")" />
    <meta name="keywords" content="@(ViewData["Keywords"] ?? "kredi, kredi başvurusu, dijital şube, interaktif kredi, online kredi, hızlı kredi")" />
    <meta name="author" content="İnteraktif Kredi" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="Turkish" />
    <meta name="revisit-after" content="7 days" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="@ViewData["Title"] - İnteraktif Kredi" />
    <meta property="og:description" content="@(ViewData["Description"] ?? "Dijital kredi başvurusu yapın, hızlı ve güvenli şekilde kredi başvurunuzu tamamlayın.")" />
    <meta property="og:locale" content="tr_TR" />
    <meta property="og:site_name" content="İnteraktif Kredi" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="@ViewData["Title"] - İnteraktif Kredi" />
    <meta name="twitter:description" content="@(ViewData["Description"] ?? "Dijital kredi başvurusu yapın, hızlı ve güvenli şekilde kredi başvurunuzu tamamlayın.")" />
    
    <title>@ViewData["Title"] - İnteraktif Kredi</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    
    <!-- CSS -->
    <link rel="stylesheet" href="~/css/main.css" asp-append-version="true" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <!-- Skip to main content (Accessibility) -->
    <a href="#main_content" class="skip_to_main">Ana içeriğe geç</a>
    
    <header class="header" role="banner">
        @{
            var customerId = Context.Session.GetString("CustomerId");
            var customerName = Context.Session.GetString("CustomerName");
            var currentPage = ViewContext.RouteData.Values["page"]?.ToString();
            
            // Onboarding sayfalarında (TcknGsm, OtpDogrula, KvkkOnay) henüz login olmamış sayılır
            // Bu sayfalarda login olmayan kullanıcının header'ı gösterilmeli
            var isOnboardingPage = currentPage?.Contains("/Onboarding/") == true;
            
            // OTP doğrulaması yapılmışsa (CustomerName varsa) kullanıcı menüsünü göster
            // Ancak onboarding sayfalarındayken henüz login olmamış sayılır, bu yüzden false döndür
            var isAuthenticated = !isOnboardingPage && !string.IsNullOrEmpty(customerId) && !string.IsNullOrEmpty(customerName);
            var isHomePage = currentPage == "/Index" || currentPage == "/";
        }
        
        <div class="header__container">
            <a href="@(isAuthenticated ? "/Dashboard" : "/")" class="header__logo">
                <img src="~/assets/image 1.png" alt="İnteraktif Kredi Logo" class="header__logo__image" />
            </a>
            
            <nav class="header__nav">
                @if (isAuthenticated)
                {
                    <a href="/Profile/Adres" class="header__link @(ViewContext.RouteData.Values["page"]?.ToString()?.Contains("/Profile") == true ? "header__link--active" : "")">Profilim</a>
                    <a href="/Raporlar/Liste" class="header__link @(ViewContext.RouteData.Values["page"]?.ToString()?.Contains("/Raporlar") == true ? "header__link--active" : "")">Raporlar</a>
                }
                @if (!isAuthenticated)
                {
                    <a href="/" class="header__link @(ViewContext.RouteData.Values["page"]?.ToString() == "/Index" || ViewContext.RouteData.Values["page"]?.ToString() == "/" ? "header__link--active" : "")">Anasayfa</a>
                    <a href="/BizKimiz" class="header__link @(ViewContext.RouteData.Values["page"]?.ToString()?.Contains("/BizKimiz") == true ? "header__link--active" : "")">Biz Kimiz</a>
                }
                <a href="/KrediRehberi" class="header__link @(ViewContext.RouteData.Values["page"]?.ToString()?.Contains("/KrediRehberi") == true ? "header__link--active" : "")">Kredi Rehberi</a>
                <a href="/Destek" class="header__link @(ViewContext.RouteData.Values["page"]?.ToString()?.Contains("/Destek") == true ? "header__link--active" : "")">Destek</a>
            </nav>
            
            @if (isAuthenticated)
            {
                <div class="header__user" id="header_user_container">
                    <div class="header__user__avatar" id="user_menu_toggle" aria-label="Kullanıcı menüsü">
                        <span id="user_avatar_initial"></span>
                    </div>
                    <span class="header__user__name" id="user_name"></span>
                    <div class="header__user__menu" id="user_menu">
                        <a href="/Profile/Adres" class="header__user__menu_item">Profil</a>
                        <a href="/Logout" class="header__user__menu_item header__user__menu_item--danger">Çıkış Yap</a>
                    </div>
                </div>
            }
            else
            {
                <div class="header__auth">
                    <a href="/Onboarding/TcknGsm" class="header__auth__login">Giriş Yap</a>
                    <a href="/Onboarding/TcknGsm" class="header__auth__register">Kayıt Ol</a>
                </div>
            }
            
            <button type="button" class="header__toggle" id="mobile_menu_toggle" aria-label="Menü">
                <span class="header__toggle__icon"></span>
            </button>
        </div>
        
        <nav class="header__mobile_menu" id="mobile_menu">
            @if (isAuthenticated)
            {
                <a href="/Profile/Adres" class="header__link">Profilim</a>
                <a href="/Raporlar/Liste" class="header__link">Raporlar</a>
            }
            @if (!isAuthenticated)
            {
                <a href="/" class="header__link">Anasayfa</a>
                <a href="/BizKimiz" class="header__link">Biz Kimiz</a>
            }
            <a href="/KrediRehberi" class="header__link">Kredi Rehberi</a>
            <a href="/Destek" class="header__link">Destek</a>
            @if (!isAuthenticated)
            {
                <div class="header__mobile_menu__auth">
                    <a href="/Onboarding/TcknGsm" class="header__auth__login">Giriş Yap</a>
                    <a href="/Onboarding/TcknGsm" class="header__auth__register">Kayıt Ol</a>
                </div>
            }
        </nav>
    </header>

    <main id="main_content" role="main" class="main_content" tabindex="-1">
        @RenderBody()
    </main>

    <footer class="footer">
        <div class="footer__container">
            <div class="footer__content">
                <div class="footer__section">
                    <h3 class="footer__section__title">Hızlı Linkler</h3>
                    <div class="footer__section__links">
                        <a href="/Dashboard" class="footer__section__link">Dashboard</a>
                        <a href="/Profile/Adres" class="footer__section__link">Profilim</a>
                        <a href="/Raporlar/Liste" class="footer__section__link">Raporlar</a>
                    </div>
                </div>
                
                <div class="footer__section">
                    <h3 class="footer__section__title">Destek</h3>
                    <div class="footer__section__links">
                        <a href="/Contact" class="footer__section__link">İletişim</a>
                        <a href="/Privacy" class="footer__section__link">Gizlilik Politikası</a>
                    </div>
                </div>
            </div>
            
            <div class="footer__bottom">
                <p class="footer__text">&copy; 2025 - İnteraktif Kredi - Web Şube 2.0. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/app.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)
    
    <script>
        // Mobile menu toggle
        $(document).ready(function() {
            var $mobileToggle = $('#mobile_menu_toggle');
            var $mobileMenu = $('#mobile_menu');
            
            $mobileToggle.on('click', function() {
                $mobileToggle.toggleClass('header__toggle--active');
                $mobileMenu.toggleClass('header__mobile_menu--visible');
            });
            
            // User menu toggle
            var $userToggle = $('#user_menu_toggle');
            var $userMenu = $('#user_menu');
            
            $userToggle.on('click', function(e) {
                e.stopPropagation();
                $userMenu.toggleClass('header__user__menu--visible');
            });
            
            // Close user menu when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.header__user').length) {
                    $userMenu.removeClass('header__user__menu--visible');
                }
            });

            // Load user info from session
            loadUserInfo();
        });

        function loadUserInfo() {
            // Session'dan kullanıcı bilgilerini al
            var customerName = '@(Context.Session.GetString("CustomerName") ?? "")';
            
            // OTP doğrulaması yapılmışsa (CustomerName varsa) kullanıcı adını göster
            if (customerName && customerName.trim() !== '') {
                $('#user_name').text(customerName.trim());
                var firstChar = customerName.trim().charAt(0).toUpperCase();
                $('#user_avatar_initial').text(firstChar);
            }
        }
    </script>
</body>
</html>