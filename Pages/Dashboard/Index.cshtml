@page
@model InteraktifKredi.Pages.Dashboard.IndexModel
@{
    ViewData["Title"] = "Dashboard";
    
    // Günün saatine göre selamlama
    var hour = DateTime.Now.Hour;
    var greeting = hour < 12 ? "Günaydın" : hour < 18 ? "İyi Günler" : "İyi Akşamlar";
}

<div class="dashboard_container">
    <!-- 2 Sütunlu Grid Layout (1fr 3fr) -->
    <div class="dashboard_grid">
        <!-- Sol Sütun: Kullanıcı Paneli (Sticky) -->
        <aside class="dashboard_sidebar">
            <!-- Üst Kart: Profil Özeti -->
            <div class="progress_card">
                <div class="progress_card__header">
                    <h2 class="progress_card__title">Profil Tamamlama</h2>
                </div>
                <div class="progress_card__body">
                    <div class="circular_progress_container">
                        <div class="circular_progress" data-percent="@Model.ProfileCompletionPercent">
                            <svg class="circular_progress__svg" viewBox="0 0 200 200">
                                <circle class="circular_progress__bg" cx="100" cy="100" r="90" />
                                <circle class="circular_progress__fill" cx="100" cy="100" r="90" />
                            </svg>
                            <div class="circular_progress__inner">
                                <span class="circular_progress__value">@Model.ProfileCompletionPercent%</span>
                            </div>
                        </div>
                        <p class="progress_card__motivation">Profilini tamamla</p>
                    </div>
                </div>
            </div>

            <!-- Alt Kart: Eksik Bilgiler -->
            @if (Model.MissingFields.Any())
            {
                <div class="missing_fields_card">
                    <div class="missing_fields_card__header">
                        <h3 class="missing_fields_card__title">Eksik Bilgiler</h3>
                    </div>
                    <div class="missing_fields_card__body">
                        <ul class="missing_fields_list">
                            @foreach (var field in Model.MissingFields)
                            {
                                var fieldUrl = field switch
                                {
                                    "Adres Bilgileri" => "/Profile/Adres",
                                    "Meslek Bilgileri" => "/Profile/Adres",
                                    "Gelir Bilgileri" => "/Profile/Adres",
                                    "Eş Bilgileri" => "/Profile/Adres",
                                    _ => "/Profile/Adres"
                                };
                                
                                <li class="missing_fields_list__item">
                                    <a href="@fieldUrl" class="missing_fields_list__link">
                                        <span class="missing_fields_list__icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                            </svg>
                                        </span>
                                        <span class="missing_fields_list__text">@field</span>
                                        <span class="missing_fields_list__action">→</span>
                                    </a>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            }
            else
            {
                <div class="missing_fields_card">
                    <div class="missing_fields_card__body">
                        <div class="missing_fields_complete">
                            <div class="missing_fields_complete__icon">✓</div>
                            <p class="missing_fields_complete__text">Tüm bilgileriniz tamamlandı!</p>
                        </div>
                    </div>
                </div>
            }
        </aside>

        <!-- Sağ Sütun: Ana İşlemler -->
        <main class="dashboard_main">
            <!-- Satır 1: Karşılama (Hero Card) -->
            <div class="hero_card">
                <h1 class="hero_card__title">
                    @greeting,
                    <span class="hero_card__name">@(Model.CustomerName ?? "Müşteri")</span>
                </h1>
                <p class="hero_card__subtitle">Kredi başvurunuzu tamamlamak için aşağıdaki hizmetlerimizi kullanabilirsiniz.</p>
            </div>

            <!-- Satır 1.5: Finansal Kredi Notu Kartı -->
            <div class="credit_note_card">
                <p class="credit_note_card__greeting">@greeting</p>
                <h2 class="credit_note_card__title">Türkiye Kredi Notu Ortalaması</h2>
                <div class="credit_note_card__score">1511</div>
                <div class="credit_note_card__risk_bar_wrapper">
                    <div class="credit_note_card__risk_bar">
                        <div class="credit_note_card__risk_bar_segment" data-range="0-699"></div>
                        <div class="credit_note_card__risk_bar_segment" data-range="700-1099"></div>
                        <div class="credit_note_card__risk_bar_segment" data-range="1100-1499"></div>
                        <div class="credit_note_card__risk_bar_segment" data-range="1500-1699"></div>
                        <div class="credit_note_card__risk_bar_segment" data-range="1700-1900"></div>
                    </div>
                    <div class="credit_note_card__risk_bar_labels">
                        <span class="credit_note_card__risk_bar_label">0-699</span>
                        <span class="credit_note_card__risk_bar_label">700-1099</span>
                        <span class="credit_note_card__risk_bar_label">1100-1499</span>
                        <span class="credit_note_card__risk_bar_label">1500-1699</span>
                        <span class="credit_note_card__risk_bar_label">1700-1900</span>
                    </div>
                </div>
                <div class="credit_note_card__actions">
                    <button type="button" class="credit_note_card__button credit_note_card__button--outline" id="sample_report_btn">Örnek Rapor</button>
                    <button type="button" class="credit_note_card__button credit_note_card__button--primary">Başvur</button>
                </div>
            </div>

            <!-- Örnek Findeks Risk Raporu Modal -->
            <div class="modal" id="sample_risk_report_modal">
                <div class="modal__overlay"></div>
                <div class="modal__container modal__container--xl">
                    <div class="modal__header">
                        <h2 class="modal__title">Örnek Findeks Risk Raporu</h2>
                        <button type="button" class="modal_close" aria-label="Kapat"></button>
                    </div>
                    <div class="modal__body">
                        <div class="sample_risk_report" id="sample_risk_report">
                <!-- Risk Seviyeleri Skalası -->
                <div class="risk_scale_card">
                    <h3 class="risk_scale_card__title">Risk Seviyeleri</h3>
                    <div class="risk_scale_bar">
                        <div class="risk_scale_bar__segment risk_scale_bar__segment--critical"></div>
                        <div class="risk_scale_bar__segment risk_scale_bar__segment--developing"></div>
                        <div class="risk_scale_bar__segment risk_scale_bar__segment--balanced"></div>
                        <div class="risk_scale_bar__segment risk_scale_bar__segment--safe"></div>
                        <div class="risk_scale_bar__segment risk_scale_bar__segment--prestigious"></div>
                    </div>
                    <div class="risk_scale_legend">
                        <div class="risk_scale_legend__item">
                            <span class="risk_scale_legend__label">Kritik</span>
                            <span class="risk_scale_legend__range">0-699</span>
                        </div>
                        <div class="risk_scale_legend__item">
                            <span class="risk_scale_legend__label">Gelişime Açık</span>
                            <span class="risk_scale_legend__range">700-1099</span>
                        </div>
                        <div class="risk_scale_legend__item">
                            <span class="risk_scale_legend__label">Dengeli</span>
                            <span class="risk_scale_legend__range">1100-1499</span>
                        </div>
                        <div class="risk_scale_legend__item">
                            <span class="risk_scale_legend__label">Güvenli</span>
                            <span class="risk_scale_legend__range">1500-1699</span>
                        </div>
                        <div class="risk_scale_legend__item">
                            <span class="risk_scale_legend__label">Prestijli</span>
                            <span class="risk_scale_legend__range">1700-1900</span>
                        </div>
                    </div>
                </div>

                <!-- Kredi Notu Geçmişi -->
                <div class="credit_history_card">
                    <div class="credit_history_card__header">
                        <h3 class="credit_history_card__title">Kredi Notu Geçmişi</h3>
                        <div class="credit_history_card__trend">
                            <span class="credit_history_card__trend__icon">↗</span>
                            <span class="credit_history_card__trend__text">+16%</span>
                        </div>
                    </div>
                    <div class="credit_history_chart">
                        <div class="credit_history_chart__y_axis">
                            <span class="credit_history_chart__axis_label">1900</span>
                            <span class="credit_history_chart__axis_label">1700</span>
                            <span class="credit_history_chart__axis_label">1500</span>
                            <span class="credit_history_chart__axis_label">1300</span>
                            <span class="credit_history_chart__axis_label">1100</span>
                        </div>
                        <svg class="credit_history_chart__svg" viewBox="0 0 540 180" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="chartGradientHistory" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.2" />
                                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0" />
                                </linearGradient>
                            </defs>
                            <!-- Grid çizgileri (1100-1900 arası, 200'er artış) -->
                            <line x1="0" y1="160" x2="540" y2="160" class="credit_history_chart__grid_line" />
                            <line x1="0" y1="130" x2="540" y2="130" class="credit_history_chart__grid_line" />
                            <line x1="0" y1="100" x2="540" y2="100" class="credit_history_chart__grid_line" />
                            <line x1="0" y1="70" x2="540" y2="70" class="credit_history_chart__grid_line" />
                            <line x1="0" y1="40" x2="540" y2="40" class="credit_history_chart__grid_line" />
                            <!-- Y ekseni çizgisi -->
                            <line x1="0" y1="20" x2="0" y2="170" class="credit_history_chart__axis_line" />
                            <!-- Grafik alanı (cubic-bezier eğrisi ile yumuşak geçiş) -->
                            <!-- Veriler: 1150, 1220, 1310, 1380, 1450, 1530 (Son 6 ay) -->
                            <path class="credit_history_chart__area" d="M 0 155 C 36 152, 72 145, 108 135 C 144 125, 180 112, 216 103 C 252 94, 288 87, 324 82 C 360 77, 396 74, 432 73 C 468 72, 504 71.5, 540 71.5 L 540 170 L 0 170 Z" fill="url(#chartGradientHistory)" />
                            <path class="credit_history_chart__line" d="M 0 155 C 36 152, 72 145, 108 135 C 144 125, 180 112, 216 103 C 252 94, 288 87, 324 82 C 360 77, 396 74, 432 73 C 468 72, 504 71.5, 540 71.5" />
                        </svg>
                        <div class="credit_history_chart__x_axis">
                            <span class="credit_history_chart__x_axis_label">Oca</span>
                            <span class="credit_history_chart__x_axis_label">Şub</span>
                            <span class="credit_history_chart__x_axis_label">Mar</span>
                            <span class="credit_history_chart__x_axis_label">Nis</span>
                            <span class="credit_history_chart__x_axis_label">May</span>
                            <span class="credit_history_chart__x_axis_label">Haz</span>
                        </div>
                    </div>
                </div>

                <!-- Kredili Ürünler Analizi -->
                <div class="credit_products_section">
                    <h3 class="credit_products_section__title">Kredili Ürünler</h3>
                    <div class="credit_products_grid">
                        <div class="credit_product_card">
                            <div class="credit_product_card__header">
                                <h4 class="credit_product_card__title">Kredi Borçlarım</h4>
                                <span class="credit_product_card__amount">125.000 ₺</span>
                            </div>
                            <div class="credit_product_card__progress">
                                <div class="credit_product_card__progress_bar">
                                    <div class="credit_product_card__progress_fill credit_product_card__progress_fill--positive" style="width: 45%"></div>
                                </div>
                                <div class="credit_product_card__progress_labels">
                                    <span class="credit_product_card__progress_label">Kullanılan: 125.000 ₺</span>
                                    <span class="credit_product_card__progress_label">Toplam: 280.000 ₺</span>
                                </div>
                            </div>
                        </div>

                        <div class="credit_product_card">
                            <div class="credit_product_card__header">
                                <h4 class="credit_product_card__title">Kredi Kartları Limitlerim</h4>
                                <span class="credit_product_card__amount">85.000 ₺</span>
                            </div>
                            <div class="credit_product_card__progress">
                                <div class="credit_product_card__progress_bar">
                                    <div class="credit_product_card__progress_fill credit_product_card__progress_fill--negative" style="width: 65%"></div>
                                </div>
                                <div class="credit_product_card__progress_labels">
                                    <span class="credit_product_card__progress_label">Kullanılan: 85.000 ₺</span>
                                    <span class="credit_product_card__progress_label">Toplam: 130.000 ₺</span>
                                </div>
                            </div>
                        </div>

                        <div class="credit_product_card">
                            <div class="credit_product_card__header">
                                <h4 class="credit_product_card__title">Ek Hesap (KMH)</h4>
                                <span class="credit_product_card__amount">15.000 ₺</span>
                            </div>
                            <div class="credit_product_card__progress">
                                <div class="credit_product_card__progress_bar">
                                    <div class="credit_product_card__progress_fill credit_product_card__progress_fill--positive" style="width: 30%"></div>
                                </div>
                                <div class="credit_product_card__progress_labels">
                                    <span class="credit_product_card__progress_label">Kullanılan: 15.000 ₺</span>
                                    <span class="credit_product_card__progress_label">Toplam: 50.000 ₺</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kullanım Alanları -->
                <div class="usage_areas_section">
                    <h3 class="usage_areas_section__title">Kullanım Alanları</h3>
                    <div class="usage_areas_grid">
                        <div class="usage_area_card">
                            <div class="usage_area_card__icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <span class="usage_area_card__label">Banka İşlemleri</span>
                        </div>
                        <div class="usage_area_card">
                            <div class="usage_area_card__icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
                                </svg>
                            </div>
                            <span class="usage_area_card__label">Araç Kiralama</span>
                        </div>
                        <div class="usage_area_card">
                            <div class="usage_area_card__icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </div>
                            <span class="usage_area_card__label">İş Başvuruları</span>
                        </div>
                        <div class="usage_area_card">
                            <div class="usage_area_card__icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                                </svg>
                            </div>
                            <span class="usage_area_card__label">Konut Kredisi</span>
                        </div>
                    </div>
                </div>

                <!-- Nasıl Hesaplanır? -->
                <div class="calculation_factors_section">
                    <h3 class="calculation_factors_section__title">Nasıl Hesaplanır?</h3>
                    <div class="calculation_factors_list">
                        <div class="calculation_factor_item">
                            <span class="calculation_factor_item__label">Ödeme Geçmişi</span>
                            <span class="calculation_factor_item__percentage">%45</span>
                            <span class="calculation_factor_item__chevron">↓</span>
                        </div>
                        <div class="calculation_factor_item">
                            <span class="calculation_factor_item__label">Borç Yükü</span>
                            <span class="calculation_factor_item__percentage">%32</span>
                            <span class="calculation_factor_item__chevron">↓</span>
                        </div>
                        <div class="calculation_factor_item">
                            <span class="calculation_factor_item__label">Kredi Kullanım Süresi</span>
                            <span class="calculation_factor_item__percentage">%18</span>
                            <span class="calculation_factor_item__chevron">↓</span>
                        </div>
                        <div class="calculation_factor_item">
                            <span class="calculation_factor_item__label">Yeni Kredi Başvuruları</span>
                            <span class="calculation_factor_item__percentage">%5</span>
                            <span class="calculation_factor_item__chevron">↓</span>
                        </div>
                    </div>
                </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Satır 2: Hızlı İşlemler (2x2 Grid - Horizontal Layout) -->
            <div class="action_grid">
                <a href="/Dashboard/KrediHesapla" class="action_widget">
                    <div class="action_widget__icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                        </svg>
                    </div>
                    <div class="action_widget__content">
                        <h3 class="action_widget__title">Kredi Hesapla</h3>
                        <p class="action_widget__description">Kredi tutarınızı hesaplayın</p>
                    </div>
                </a>

                <a href="/Profile/Adres" class="action_widget">
                    <div class="action_widget__icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <div class="action_widget__content">
                        <h3 class="action_widget__title">Profil Bilgilerim</h3>
                        <p class="action_widget__description">Profilinizi tamamlayın</p>
                    </div>
                </a>

                <a href="/Raporlar/Liste" class="action_widget">
                    <div class="action_widget__icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                    </div>
                    <div class="action_widget__content">
                        <h3 class="action_widget__title">Raporlarım</h3>
                        <p class="action_widget__description">Kredi başvuru raporlarınız</p>
                    </div>
                </a>

                <a href="/SSS" class="action_widget">
                    <div class="action_widget__icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
                        </svg>
                    </div>
                    <div class="action_widget__content">
                        <h3 class="action_widget__title">Sık Sorulan Sorular</h3>
                        <p class="action_widget__description">Yardıma mı ihtiyacınız var?</p>
                    </div>
                </a>
            </div>

            <!-- Satır 3: Son İşlemler (Timeline) -->
            <div class="timeline_card">
                <div class="timeline_card__header">
                    <h2 class="timeline_card__title">Son İşlemler</h2>
                </div>
                <div class="timeline_card__body">
                    <div class="timeline">
                        <div class="timeline__step timeline__step--completed">
                            <div class="timeline__step__dot">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                            </div>
                            <div class="timeline__step__content">
                                <div class="timeline__step__title">OTP Doğrulandı</div>
                                <div class="timeline__step__date">Bugün</div>
                            </div>
                        </div>

                        <div class="timeline__step timeline__step--completed">
                            <div class="timeline__step__dot">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                            </div>
                            <div class="timeline__step__content">
                                <div class="timeline__step__title">KVKK Onayı Verildi</div>
                                <div class="timeline__step__date">Bugün</div>
                            </div>
                        </div>
                    </div>
                </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Circular progress animation
            var $circularProgress = $('.circular_progress');
            if ($circularProgress.length) {
                var percent = parseFloat($circularProgress.data('percent')) || 0;
                var circumference = 2 * Math.PI * 90; // radius = 90
                var offset = circumference - (percent / 100) * circumference;
                
                $circularProgress.find('.circular_progress__fill').css({
                    'stroke-dasharray': circumference,
                    'stroke-dashoffset': offset
                });
            }

            // Örnek Rapor Modal
            var $sampleReportBtn = $('#sample_report_btn');
            var $sampleReportModal = $('#sample_risk_report_modal');
            var $modalOverlay = $sampleReportModal.find('.modal__overlay');
            var $modalClose = $sampleReportModal.find('.modal_close');

            // Modal aç
            function openSampleReportModal() {
                $sampleReportModal.addClass('modal--visible');
                $('body').addClass('modal_open');
            }

            // Modal kapat
            function closeSampleReportModal() {
                $sampleReportModal.removeClass('modal--visible');
                $('body').removeClass('modal_open');
            }

            // Butona tıklanınca aç
            $sampleReportBtn.on('click', function(e) {
                e.preventDefault();
                openSampleReportModal();
            });

            // Close butonuna tıklanınca kapat
            $modalClose.on('click', function(e) {
                e.preventDefault();
                closeSampleReportModal();
            });

            // Overlay'e tıklanınca kapat
            $modalOverlay.on('click', function(e) {
                if ($(e.target).is($modalOverlay)) {
                    closeSampleReportModal();
                }
            });

            // ESC tuşu ile kapat
            $(document).on('keydown', function(e) {
                if (e.key === 'Escape' && $sampleReportModal.hasClass('modal--visible')) {
                    closeSampleReportModal();
                }
            });

            // Kredi notu geçmişi grafik rengini dinamik olarak ayarla
            function updateChartLineColor(score) {
                var $chartLine = $('.credit_history_chart__line');
                var color;

                if (score >= 1700) {
                    color = '#1d4ed8'; // Prestijli - Koyu mavi
                } else if (score >= 1500) {
                    color = '#3b82f6'; // Güvenli - Açık mavi
                } else if (score >= 1100) {
                    color = '#eab308'; // Dengeli - Sarı
                } else if (score >= 700) {
                    color = '#f97316'; // Gelişime Açık - Turuncu
                } else {
                    color = '#ef4444'; // Kritik - Kırmızı
                }

                $chartLine.css('stroke', color);
                
                // Gradient'i de güncelle
                var $svg = $chartLine.closest('svg');
                var gradientId = 'chartGradientHistory';
                var gradientDef = $svg.find('defs linearGradient#' + gradientId);
                
                if (gradientDef.length) {
                    gradientDef.find('stop').each(function() {
                        var currentStyle = $(this).attr('style') || '';
                        var newStyle = currentStyle.replace(/#[0-9a-fA-F]{6}/g, color);
                        $(this).attr('style', newStyle);
                    });
                }
            }

            // Sayfa yüklendiğinde grafik rengini güncelle (1530 skoru için - Güvenli segment)
            updateChartLineColor(1530);
        });
    </script>
}
